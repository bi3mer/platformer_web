class E{scenes={};registerScene(X,F){if(this.scenes[X]===void 0)this.scenes[X]=F;else console.error(`Key "${X}" for scene already exists! Scene not added to SceneManager.`)}getScene(X){return this.scenes[X]}}class x{changeScene;onExit(){this.changeScene=void 0,this._onExit()}}var Y="main menu",u="game";class d extends x{constructor(){super()}onEnter(){}update(X){this.changeScene=u}render(){}_onExit(){}}var S=720,T=480,I=32,H=15,QX=17,$X=20,JX=30,fX=0.625,ZX=0.9375,VX=31,BX=31,kX=0.96875,zX=0.96875,wX=16,WX=16,UX=0.5,vX=0.5,N=25,M=15,_=0.78125,K=0.46875,L="start",h="end",w="death";class y{startCol=0;endCol=0;offsetX=0;colsPerScreen=Math.ceil(S/I);update(X){const F=X-this.colsPerScreen/2;this.startCol=Math.max(0,Math.floor(F)),this.endCol=this.startCol+this.colsPerScreen,this.offsetX=-F*I+this.startCol*I}columnToScreen(X){return(X-this.startCol)*I+this.offsetX}rowToScreen(X){return X*I}}class O{x;y;constructor(X,F){this.x=X,this.y=F}copy(){return new O(this.x,this.y)}zero(){this.x=0,this.y=0}equals(X){return this.x==X.x&&this.y==X.y}add(X){return new O(this.x+X.x,this.y+X.y)}addInPlace(X){this.x+=X.x,this.y+=X.y}subtract(X){return new O(this.x-X.x,this.y-X.y)}subtractInPlace(X){this.x-=X.x,this.y-=X.y}scalarAdd(X){this.x+=X,this.y+=X}scalarSubtract(X){this.x-=X,this.y-=X}scalarMultiply(X){return new O(this.x*X,this.y*X)}scalarMultiplyInPlace(X){this.x*=X,this.y*=X}dot(X){return this.x*X.x+this.y+X.y}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}}function LX(X,F,q,Q){const{x:$,y:f}=X,J=$+F.x,k=f+F.y,z=q.x,v=q.y,A=z+Q.x,j=v+Q.y;return $<A&&J>z&&f<j&&k>v}class R{pos;size;type;dead=!1;velocity=new O(0,0);gravity=new O(0,100);constructor(X,F,q,Q,$){this.pos=new O(X,F),this.size=new O(q,Q),this.type=$}collision(X){if(LX(this.pos,this.size,X.pos,X.size))this.handleCollision(X),X.handleCollision(this)}physicsUpdate(X){this.velocity.addInPlace(this.gravity.scalarMultiply(X)),this.velocity.y=Math.min(this.velocity.y,30),this.pos.addInPlace(this.velocity.scalarMultiply(X))}}var G=0,C=1,g=2,b=3;var B;(function(V){V[V["LEFT"]=0]="LEFT";V[V["RIGHT"]=1]="RIGHT";V[V["DOWN"]=2]="DOWN";V[V["UP"]=3]="UP";V[V["A"]=4]="A";V[V["D"]=5]="D";V[V["E"]=6]="E";V[V["G"]=7]="G";V[V["H"]=8]="H";V[V["I"]=9]="I";V[V["Q"]=10]="Q";V[V["R"]=11]="R";V[V["S"]=12]="S";V[V["W"]=13]="W";V[V["SPACE"]=14]="SPACE";V[V["ESCAPE"]=15]="ESCAPE";V[V["ENTER"]=16]="ENTER";V[V["SHIFT"]=17]="SHIFT";V[V["INVALID"]=18]="INVALID"})(B||(B={}));class W{static _keys=[];static init(){for(let X=0;X<Object.keys(B).length;++X)W._keys.push(!1);window.addEventListener("keydown",W.onKeyDown),window.addEventListener("keyup",W.onKeyUp)}static isKeyDown(...X){const F=X.length;for(let q=0;q<F;++q)if(W._keys[X[q]])return!0;return!1}static keyStrToKey(X){switch(X){case"Down":case"ArrowDown":return B.DOWN;case"Up":case"ArrowUp":return B.UP;case"Right":case"ArrowRight":return B.RIGHT;case"Left":case"ArrowLeft":return B.LEFT;case" ":case"Space":return B.SPACE;case"Escape":return B.ESCAPE;case"a":case"A":return B.A;case"e":case"E":return B.E;case"s":case"S":return B.S;case"d":case"D":return B.D;case"w":case"W":return B.W;case"r":case"R":return B.R;case"q":case"Q":return B.Q;case"g":case"G":return B.G;case"h":case"H":return B.H;case"i":case"I":return B.I;case"Shift":return B.SHIFT;case"Enter":return B.ENTER;default:return console.warn(`Unhandled key: ${X}.`),B.INVALID}}static onKeyDown(X){const F=W.keyStrToKey(X.key);if(W._keys[F]=!0,F==B.DOWN||F==B.UP||F==B.LEFT||F==B.RIGHT)X.preventDefault();return!1}static onKeyUp(X){return W._keys[W.keyStrToKey(X.key)]=!1,!1}static clear(){for(let X=0;X<W._keys.length;++X)W._keys[X]=!1}}var RX=6,jX=8,HX=0.4;class l extends R{movingRight=!1;movingLeft=!1;moveMod=0;jumpTime=0;squash=1;stretch=1;coinsCollected=0;maxColumn=0;constructor(X,F){super(X,F,fX,ZX,G)}update(X){if(this.pos.y>QX){this.dead=!0,console.log("Player fell...");return}if(this.velocity.x=0,W.isKeyDown(B.D,B.RIGHT))this.movingRight=!0,this.velocity.x=RX,this.moveMod=Math.min(jX,this.moveMod+X);if(W.isKeyDown(B.A,B.LEFT))if(this.movingRight)this.movingRight=!1,this.velocity.x=0;else this.movingLeft=!0,this.velocity.x=-RX,this.moveMod=Math.min(jX,this.moveMod+X);if(this.jumpTime<HX&&W.isKeyDown(B.SPACE,B.UP)){if(this.jumpTime===0)this.velocity.y=-15;else if(this.jumpTime<0.2)this.velocity.y-=2;this.squash+=0.01,this.stretch-=0.01,this.jumpTime+=X}else if(this.squash!=this.stretch)this.squash+=0.01,this.stretch-=0.01;this.maxColumn=Math.max(this.pos.x,this.maxColumn)}handleCollision(X){switch(X.type){case C:{const F=this.pos.add(this.size.scalarMultiply(0.5)),q=X.pos.add(X.size.scalarMultiply(0.5)),Q=F.subtract(q);this.size.add(X.size).scalarMultiply(0.5);const f=Math.abs(Math.atan(Q.y/Q.x));if(!(f<0.96&&f>0.698)&&Math.abs(Q.x/this.size.x)>Math.abs(Q.y/this.size.y))if(Q.x<0)this.pos.x=X.pos.x-this.size.x;else this.pos.x=X.pos.x+X.size.x;else if(Q.y>0)this.pos.y=X.pos.y+X.size.y;else this.pos.y=X.pos.y-this.size.y,this.velocity.y=0,this.jumpTime=0,this.stretch=1.03,this.squash=0.97;break}case g:{++this.coinsCollected;break}case b:{this.dead=!0,console.log("Ran into an enemy! :/");break}default:{console.warn(`Player unhandled collision type: ${X.type}.`);break}}}render(X,F){X.fillStyle="rgba(150,150,255,1)";const q=F.columnToScreen(this.pos.x),Q=F.rowToScreen(this.pos.y),$=JX*this.squash,f=$X*this.stretch;if(this.movingRight){let J=new Path2D;J.moveTo(q,Q),J.lineTo(q-this.moveMod,Q+$),J.lineTo(q+f-this.moveMod,Q+$),J.lineTo(q+f,Q),J.closePath(),X.fill(J,"evenodd"),this.movingRight=!1}else if(this.movingLeft){let J=new Path2D;J.moveTo(q,Q),J.lineTo(q+this.moveMod,Q+$),J.lineTo(q+f+this.moveMod,Q+$),J.lineTo(q+f,Q),J.closePath(),X.fill(J,"evenodd"),this.movingLeft=!1}else X.fillRect(q,Q,f,$)}}class c extends R{constructor(X,F){super(X,F,kX,zX,C)}update(X){}handleCollision(X){}render(X,F){X.strokeStyle="white",X.strokeRect(F.columnToScreen(this.pos.x),F.rowToScreen(this.pos.y),VX,BX)}}class m extends R{minY;maxY;yMod;constructor(X,F){super(X+0.25,F+0.25,UX,vX,g);this.gravity.y=0,this.yMod=Math.random()*0.5,this.maxY=F+0.3,this.minY=F+0.15,this.velocity.y=this.yMod}update(X){if(this.pos.y>=this.maxY)this.velocity.y=-this.yMod;else if(this.pos.y<=this.minY)this.velocity.y=this.yMod}handleCollision(X){if(X.type===G)this.dead=!0}render(X,F){X.fillStyle="yellow",X.fillRect(F.columnToScreen(this.pos.x),F.rowToScreen(this.pos.y),wX,WX)}}class r extends R{maxColumns;constructor(X,F,q){super(X+0.25,F+0.25,_,K,b);this.velocity.x=3,this.gravity.y=0,this.maxColumns=q}update(X){if(this.pos.x<0||this.pos.x>this.maxColumns)this.velocity.x*=-1}handleCollision(X){if(X.type===C){const F=this.pos.add(this.size.scalarMultiply(0.5)),q=X.pos.add(X.size.scalarMultiply(0.5)),Q=F.subtract(q);if(this.size.add(X.size).scalarMultiply(0.5),Math.abs(Q.x/this.size.x)>Math.abs(Q.y/this.size.y))if(this.velocity.x*=-1,Q.x<0)this.pos.x=X.pos.x-this.size.x;else this.pos.x=X.pos.x+X.size.x}}render(X,F){X.fillStyle="red",X.fillRect(F.columnToScreen(this.pos.x),F.rowToScreen(this.pos.y),N,M)}}class n extends R{constructor(X,F){super(X,F+0.1,K,_,b);this.velocity.y=3,this.gravity.y=0,this.pos.x+=0.25}update(X){if(this.pos.y<0||this.pos.y>=H)this.velocity.y*=-1}handleCollision(X){if(X.type===C){const F=this.pos.add(this.size.scalarMultiply(0.5)),q=X.pos.add(X.size.scalarMultiply(0.5)),Q=F.subtract(q);if(this.size.add(X.size).scalarMultiply(0.5),Math.abs(Q.x/this.size.x)<Math.abs(Q.y/this.size.y))if(this.velocity.y*=-1,Q.y>0)this.pos.y=X.pos.y+X.size.y;else this.pos.y=X.pos.y-this.size.y}}render(X,F){X.fillStyle="red",X.fillRect(F.columnToScreen(this.pos.x),F.rowToScreen(this.pos.y),M,N)}}class i{src;tgt;probability;constructor(X,F,q){this.src=X,this.tgt=F,this.probability=q}}class D{name;reward;utility;isTerminal;neighbors;constructor(X,F,q,Q,$){this.name=X,this.reward=F,this.utility=q,this.isTerminal=Q,this.neighbors=$}}class p{nodes;edges;constructor(){this.nodes={},this.edges={}}getNode(X){return this.nodes[X]}hasNode(X){return X in this.nodes}addNode(X){this.nodes[X.name]=X}addDefaultNode(X,F=1,q=0,Q=!1,$=null){if($==null)$=[];this.nodes[X]=new D(X,F,q,Q,$)}removeNode(X){const F=[];for(let q of Object.values(this.edges)){if(q.src==X||q.tgt==X)F.push(q);const Q=q.probability;let $=-1;for(let z=0;z<Q.length;z++){const[v,A]=Q[z];if(v==X){$=z;break}}if($==-1)continue;const f=Q[$][1];Q.splice($,1);const J=Q.length,k=f/J;q.probability=Q.map(([z,v])=>[z,v+k])}for(let q of F)this.removeEdge(q.src,q.tgt);delete this.nodes[X]}getEdge(X,F){return this.edges[`${X},${F}`]}hasEdge(X,F){return`${X},${F}`in this.edges}addEdge(X){this.edges[`${X.src},${X.tgt}`]=X;const F=this.nodes[X.src].neighbors;if(!F.includes(X.tgt))F.push(X.tgt)}addDefaultEdge(X,F,q=null){if(q==null)q=[[F,1]];this.addEdge(new i(X,F,q))}removeEdge(X,F){const q=this.nodes[X],Q=X.indexOf(F);q.neighbors.splice(Q,1),delete this.edges[`${X},${F}`]}neighbors(X){return this.nodes[X].neighbors}setNodeUtilities(X){for(let[F,q]of Object.entries(X))this.nodes[F].utility=q}utility(X){return this.nodes[X].utility}reward(X){return this.nodes[X].reward}isTerminal(X){return this.nodes[X].isTerminal}mapNodes(X){for(let F of Object.values(this.nodes))X(F)}mapEdges(X){for(let F of Object.values(this.edges))X(F)}}function OX(X){return X[Math.floor(Math.random()*X.length)]}function P(X,F,q,Q){const $=X.getEdge(F,q).probability,f=$.length;let J=0;for(let k=0;k<f;++k){const[z,v]=$[k];J+=v*(X.reward(z)+Q*X.utility(z))}return J}function s(X,F,q){const Q=X.getNode(F);if(Q.isTerminal)return 0;const $=Q.neighbors,f=$.length;let J=(-Infinity);for(let k=0;k<f;++k)J=Math.max(J,P(X,F,$[k],q));return J}function o(X){for(let F in X.nodes)X.nodes[F].utility=0}function t(X){const F={};for(let q in X.nodes)if(!X.getNode(q).isTerminal)F[q]=OX(X.neighbors(q));return F}var YX=function(X,F,q,Q){for(let $=0;$<Q;++$)for(let f in X.nodes){const J=X.getNode(f);if(!J.isTerminal)J.utility=P(X,f,F[f],q)}},SX=function(X,F,q,Q){for(let $=0;$<Q;++$){const f={};for(let J in X.nodes)if(!X.getNode(J).isTerminal)f[J]=P(X,J,F[J],q);X.setNodeUtilities(f)}},IX=function(X,F,q,Q){for(let $=0;$<Q;++$)for(let f in X.nodes)X.getNode(f).utility=s(X,f,q)},bX=function(X,F,q,Q){for(let $=0;$<Q;++$){const f={};for(let J in X.nodes)f[J]=s(X,J,q);X.setNodeUtilities(f)}},CX=function(X,F,q){let Q=!1;for(let $ in X.nodes){if(X.getNode($).isTerminal)continue;let f=null,J=(-Infinity);for(let k of X.neighbors($)){const z=P(X,$,k,q);if(z>J)f=k,J=z}if(F[$]!==f)F[$]=f,Q=!0}return Q};function a(X,F,q=!1,Q=!1,$=10,f=!0){if(f)o(X);const J=t(X);let k;if(q&&Q)k=YX;else if(q&&!Q)k=SX;else if(!q&&Q)k=IX;else k=bX;let z=!0;while(z)k(X,J,F,$),z=CX(X,J,F);return k(X,J,F,$),CX(X,J,F),J}class U extends D{visitedCount;sumPercentCompleted;designerReward;playerReward;constructor(X,F,q,Q,$){super(X,F,q,Q,$);this.designerReward=F,this.playerReward=0,this.visitedCount=1,this.sumPercentCompleted=1}updateReward(){this.reward=this.designerReward*this.visitedCount}}var Z=new p;Z.addNode(new U(L,0,0,!1,[]));Z.addNode(new U(w,-1,0,!0,[]));Z.addNode(new U(h,1,0,!0,[]));Z.addNode(new U("4-b",-0.4444444444444444,0,!1,[]));Z.addNode(new U("2-b",-0.6666666666666666,0,!1,[]));Z.addNode(new U("3-b",-0.5555555555555556,0,!1,[]));Z.addNode(new U("4-a",-0.4444444444444444,0,!1,[]));Z.addNode(new U("3-a",-0.5555555555555556,0,!1,[]));Z.addNode(new U("2-a",-0.6666666666666666,0,!1,[]));Z.addNode(new U("6-a",-0.2222222222222222,0,!1,[]));Z.addNode(new U("1-a",-0.7777777777777778,0,!1,[]));Z.addNode(new U("5-c",-0.3333333333333333,0,!1,[]));Z.addNode(new U("5-a",-0.3333333333333333,0,!1,[]));Z.addNode(new U("5-b",-0.3333333333333333,0,!1,[]));Z.addDefaultEdge("4-b","5-a",[["5-a",0.99],[w,0.01]]);Z.addDefaultEdge("4-b","5-b",[["5-b",0.99],[w,0.01]]);Z.addDefaultEdge("4-b","5-c",[["5-c",0.99],[w,0.01]]);Z.addDefaultEdge("2-b","3-a",[["3-a",0.99],[w,0.01]]);Z.addDefaultEdge("3-b","4-a",[["4-a",0.99],[w,0.01]]);Z.addDefaultEdge("3-b","4-b",[["4-b",0.99],[w,0.01]]);Z.addDefaultEdge("4-a","5-a",[["5-a",0.99],[w,0.01]]);Z.addDefaultEdge("4-a","5-b",[["5-b",0.99],[w,0.01]]);Z.addDefaultEdge("4-a","5-c",[["5-c",0.99],[w,0.01]]);Z.addDefaultEdge("3-a","4-a",[["4-a",0.99],[w,0.01]]);Z.addDefaultEdge("3-a","4-b",[["4-b",0.99],[w,0.01]]);Z.addDefaultEdge("2-a","3-b",[["3-b",0.99],[w,0.01]]);Z.addDefaultEdge("6-a","end",[["end",0.99],[w,0.01]]);Z.addDefaultEdge(L,"1-a",[["1-a",0.99],[w,0.01]]);Z.addDefaultEdge("1-a","2-a",[["2-a",0.99],[w,0.01]]);Z.addDefaultEdge("1-a","2-b",[["2-b",0.99],[w,0.01]]);Z.addDefaultEdge("5-c","5-a",[["5-a",0.99],[w,0.01]]);Z.addDefaultEdge("5-c","5-b",[["5-b",0.99],[w,0.01]]);Z.addDefaultEdge("5-c","6-a",[["6-a",0.99],[w,0.01]]);Z.addDefaultEdge("5-a","5-b",[["5-b",0.99],[w,0.01]]);Z.addDefaultEdge("5-a","5-c",[["5-c",0.99],[w,0.01]]);Z.addDefaultEdge("5-a","6-a",[["6-a",0.99],[w,0.01]]);Z.addDefaultEdge("5-b","5-a",[["5-a",0.99],[w,0.01]]);Z.addDefaultEdge("5-b","6-a",[["6-a",0.99],[w,0.01]]);var AX={"4-b":["--------------------XX","--------------------XX","--------------------XX","--------------------XX","--------------------XX","-------------H------XX","-----------------o--XX","--------------------XX","-----------XXXXXXX--XX","--------------------XX","-------X------------XX","------XXX-----------XX","-----XXXXX-----------o","----XXXXXXX-----------","XXXXXXXXXXXXXXXX--XXXX"],"2-b":["----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","-----------o----------","--------------------o-","-----X---H-----X------","XXXXXXXXXXXXXXXXXXXXXX"],"3-b":["----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","-----------o----------","--------------------o-","-----X---H-----X------","XXXXXXXXXXXXXXXXXXXXXX"],"4-a":["----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","-----------------X----","-----------------V----","-------X--------------","------XX------o----o--","-----XXX--------------","XXXXXXXX---XXXXXXXXXXX"],"3-a":["----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","-------XXXXXXXX-------","----------------------","-------V--o---V-----o-","----------------------","XXXXXXXXXXXXXXXXXXXXXX"],end:["----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----oooooooooooooooooo","XXXXXXXXXXXXXXXXXXXXXX"],"2-a":["----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","-------XXXXXXXX-------","----------------------","-------V--o---V-----o-","----------------------","XXXXXXXXXXXXXXXXXXXXXX"],"6-a":["-------------------V---------------","-----------------o---o-------------","------------X-H------------H--XXX--","-----V------XXXXXXXXXXXXXXXXXXXXX--","--------XX----o--------------------","-----------------------------------","-----------XXXXXX---Ho-------------","-----------------------------------","-------------V------XX--------H----","-----------------------------------","XX--------o------XXXXX----H--------","-----------------------------------","---X----H----H-X-----------------o-","---XXXXXXXXXXXXX-------------------","XXXX--------------------------XXXXX"],"1-a":["----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","----------------------","--------------X-------","-----o-----o--X------o","XXXXXXXXXXXXXXXXXXXXXX"],"5-c":["0-----------------------------","------------------------------","X---XX------------------------","------------------------------","--------XX--------------------","XX----------------------------","--------XXXXX-----------------","--------Xoo-------------------","XXX-----Xoo----o------------o-","--------X---------------------","--------XXX---XX----XX----XXXX","XXXX--------------------------","------------------------------","------------------------------","XXXXXXXX----------------------"],"5-a":["---------------------X--------","-------------------o-X--------","---------------------X--------","---------------------X--------","------------------XXXX--------","------------------------------","-----------o--XX--------------","------------------------------","----------XX----------------o-","------------------------------","--------------XX---XXX----XXXX","------------------------------","----------XX------------------","------------------------------","XXXXXXXX----------------------"],"5-b":["------------------------------","-o----------------------------","------------------------------","XXX---------------------------","------------------------------","-----XXX----------------------","------------------------------","-----------XXX----------------","-o--------------------------o-","------XXX---------------------","XXX-----------------------XXXX","------------XXX-------XX------","------------------XX----------","------------------------------","XXXXXXXX---XXXXX--------------"]};class e{keys;columnsPerLevel;lossesInARow=0;constructor(){}update(X,F){const q=this.keys.length,Q=[];if(X){for(let f=0;f<q;++f)Q.push(1);this.lossesInARow=0}else{let f=F;for(let J=0;J<q;++J)if(f>this.columnsPerLevel[J])Q[J]=1,f-=this.columnsPerLevel[J];else{Q[J]=f/this.columnsPerLevel[J];break}++this.lossesInARow;for(let J=0;J<this.lossesInARow;++J){const k=Z.getNode(L).neighbors,z=k.length;if(z===1)break;let v="",A=-1e4;for(let j=0;j<z;++j){const qX=Z.getNode(k[j]).reward;if(qX>A)v=k[j],A=qX}console.log(`Removing edge ${L} -> ${v}...`),Z.removeEdge(L,v),console.log(`Count from ${z} to ${Z.getNode(L).neighbors.length}`)}}const $=Q.length;for(let f=0;f<$;++f){const J=Q[f],k=this.keys[f],z=Z.getNode(k);if(J===1){if(!Z.hasEdge(L,k))Z.addDefaultEdge(L,k,[[k,1],[w,0]])}++z.visitedCount,z.sumPercentCompleted+=J,z.updateReward();const v=z.sumPercentCompleted/z.visitedCount,A=1-v;Z.mapEdges((j)=>{if(j.tgt===k)j.probability[0][1]=v,j.probability[1][1]=A})}}get(X){this.columnsPerLevel=[],this.keys=[L];const F=a(Z,0.95,!0,!0,20);for(let $=0;$<X;++$){const f=F[this.keys[$]];if(this.keys.push(f),f===h)break}this.keys.splice(0,1);const q=Array(H).fill(""),Q=this.keys.length;for(let $=0;$<Q;++$){const f=AX[this.keys[$]];this.columnsPerLevel.push(f[0].length);for(let J=0;J<H;++J)q[J]+=f[J]}return q}}class XX extends x{ctx;camera;numCoins;levelDirector;staticEntities;dynamicEntities;constructor(X){super();this.ctx=X,this.camera=new y,this.levelDirector=new e}onEnter(){this.dynamicEntities=[],this.staticEntities=[],this.numCoins=0,this.dynamicEntities.push(new l(2,12));const X=this.levelDirector.get(3),F=X.length;if(F!==H){console.error("Level should have 15 rows!");return}const q=X[0].length;for(let Q=0;Q<F;++Q){const $=X[Q];if(q!==$.length){console.error(`Every row in the level should have the same number of columns! (${q} !== ${$.length}).`);return}for(let f=0;f<q;++f)if($[f]==="X")this.staticEntities.push(new c(f,Q));else if($[f]==="o")++this.numCoins,this.dynamicEntities.push(new m(f,Q));else if($[f]==="H")this.dynamicEntities.push(new r(f,Q,q));else if($[f]==="V")this.dynamicEntities.push(new n(f,Q))}this.columnsInLevel=q}update(X){let F=this.dynamicEntities.length,q=0;for(;q<F;++q)if(this.dynamicEntities[q].dead)this.dynamicEntities.splice(q,1),--F,--q;const Q=this.staticEntities.length;let $;for(q=0;q<F;++q){const J=this.dynamicEntities[q];J.update(X),J.physicsUpdate(X);for($=q+1;$<F;++$)J.collision(this.dynamicEntities[$]);for($=0;$<Q;++$)J.collision(this.staticEntities[$])}const f=this.dynamicEntities[0];if(f.coinsCollected>=this.numCoins)console.log("Player won!"),this.changeScene=Y;if(f.dead)this.changeScene=Y}render(){this.ctx.clearRect(0,0,S,T),this.camera.update(this.dynamicEntities[0].pos.x);let X=this.staticEntities.length,F=0;for(;F<X;++F)this.staticEntities[F].render(this.ctx,this.camera);X=this.dynamicEntities.length;for(F=0;F<X;++F)this.dynamicEntities[F].render(this.ctx,this.camera)}_onExit(){const X=this.dynamicEntities[0];this.levelDirector.update(!X.dead,Math.floor(X.maxColumn))}}class FX{canvas;ctx;currentScene;sceneManager;constructor(){this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id","canvas"),this.canvas.width=S,this.canvas.height=T,this.ctx=this.canvas.getContext("2d"),document.getElementById("game").appendChild(this.canvas),this.sceneManager=new E,this.sceneManager.registerScene(Y,new d),this.sceneManager.registerScene(u,new XX(this.ctx)),this.currentScene=this.sceneManager.getScene(Y),this.currentScene.onEnter()}start(){let X=0;const F=(q)=>{const Q=Math.min(0.05,(q-X)/1000);X=q,this.currentScene.update(Q),this.currentScene.render();const $=this.currentScene.changeScene;if($!==void 0)this.currentScene.onExit(),this.currentScene=this.sceneManager.getScene($),this.currentScene.onEnter();window.requestAnimationFrame(F)};window.requestAnimationFrame(F)}}window.addEventListener("load",()=>{W.init(),new FX().start()});
